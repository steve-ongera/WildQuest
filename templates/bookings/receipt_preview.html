{% extends 'base.html' %}
{% load static %}

{% block title %}Receipt Preview - WildQuest Kenya{% endblock %}

{% block content %}
<!-- Hero Start -->
<div class="container-fluid pb-5 bg-primary hero-header">
    <div class="container py-5">
        <div class="row g-3 align-items-center">
            <div class="col-lg-8 text-center text-lg-start">
                <h1 class="display-4 mb-0 animated slideInLeft">Receipt Preview</h1>
                <p class="text-light mt-2">Booking ID: {{ booking.booking_id }}</p>
            </div>
            <div class="col-lg-4 animated slideInRight">
                <div class="text-end">
                    <a href="{% url 'booking_receipt_pdf' booking.booking_id %}" class="btn btn-light btn-lg">
                        <i class="fas fa-download me-2"></i>Download PDF
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Hero End -->

<!-- Receipt Preview -->
<div class="container-fluid py-5" style="background-color: #f8f9fa;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-4">
                <!-- Compact Receipt Preview -->
                <div class="bg-white shadow-lg" style="border: 2px solid #000; font-family: 'Courier New', monospace; font-size: 12px;">
                    <div style="padding: 15px;">
                        <!-- Header -->
                        <div style="text-align: center; border-bottom: 1px solid #000; padding-bottom: 8px; margin-bottom: 10px;">
                            <div style="font-weight: bold; font-size: 16px; letter-spacing: 1px;">WILDQUEST KENYA</div>
                            <div style="font-size: 10px; font-style: italic; margin: 3px 0;">Adventure Awaits</div>
                            <div style="font-size: 9px; line-height: 1.2;">
                                {{ contact_info.phone }} | {{ contact_info.email }}<br>
                                Nairobi, Kenya
                            </div>
                        </div>

                        <!-- Receipt Title -->
                        <div style="text-align: center; background: #000; color: white; padding: 5px; margin: 10px 0; font-weight: bold;">
                            BOOKING RECEIPT
                        </div>

                        <!-- Booking ID -->
                        <div style="text-align: center; background: #000; color: white; padding: 3px; margin: 8px 0; font-size: 10px; font-weight: bold;">
                            {{ booking.booking_id }}
                        </div>

                        <!-- Basic Info -->
                        <div style="margin: 8px 0;">
                            <div style="display: flex; justify-content: space-between; margin: 3px 0; font-size: 10px;">
                                <strong>Date:</strong>
                                <span>{{ receipt_date|date:"M d, Y H:i" }}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 3px 0; font-size: 10px;">
                                <strong>Status:</strong>
                                <span style="border: 1px solid #000; padding: 2px 5px; font-size: 8px; font-weight: bold;">
                                    {{ booking.get_status_display }}
                                </span>
                            </div>
                        </div>

                        <div style="border-top: 1px dashed #000; margin: 8px 0;"></div>

                        <!-- Customer Info -->
                        <div style="margin: 8px 0;">
                            <div style="display: flex; justify-content: space-between; margin: 3px 0; font-size: 10px;">
                                <strong>Customer:</strong>
                                <span>{{ booking.customer_name }}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 3px 0; font-size: 10px;">
                                <strong>Phone:</strong>
                                <span>{{ booking.customer_phone }}</span>
                            </div>
                        </div>

                        <!-- Event Info -->
                        <div style="background: #f5f5f5; padding: 8px; margin: 8px 0; border: 1px solid #ccc;">
                            <div style="font-weight: bold; text-align: center; margin-bottom: 5px; font-size: 11px;">
                                {{ booking.event.title|truncatechars:35 }}
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 9px;">
                                <span>{{ booking.event.location.name }}, {{ booking.event.location.county }}</span>
                                <span>{{ booking.event.start_date|date:"M d, Y" }}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 9px;">
                                <span>{{ booking.event.duration_days }} day{{ booking.event.duration_days|pluralize }}</span>
                                <span>{{ booking.event.category.name }}</span>
                            </div>
                        </div>

                        <!-- Participants -->
                        <div style="text-align: center; border: 1px solid #ccc; padding: 5px; margin: 8px 0; font-size: 10px;">
                            <strong>PARTICIPANTS: {{ booking.number_of_participants }}</strong><br>
                            <span style="font-size: 9px;">({{ booking.adults_count }} Adults, {{ booking.children_count }} Children)</span>
                        </div>

                        {% if booking.pricing_tier %}
                        <div style="display: flex; justify-content: space-between; margin: 3px 0; font-size: 10px;">
                            <strong>Package:</strong>
                            <span>{{ booking.pricing_tier.name }}</span>
                        </div>
                        {% endif %}

                        <div style="border-top: 1px dashed #000; margin: 8px 0;"></div>

                        <!-- Pricing -->
                        <div style="margin: 10px 0;">
                            <div style="display: flex; justify-content: space-between; font-size: 10px; margin: 2px 0;">
                                <span>Base Amount:</span>
                                <span>KES {{ booking.base_amount|floatformat:0 }}</span>
                            </div>
                            {% if booking.discount_amount > 0 %}
                            <div style="display: flex; justify-content: space-between; font-size: 10px; margin: 2px 0;">
                                <span>Discount:</span>
                                <span>-KES {{ booking.discount_amount|floatformat:0 }}</span>
                            </div>
                            {% endif %}
                            <div style="display: flex; justify-content: space-between; font-weight: bold; border-top: 1px solid #000; border-bottom: 1px solid #000; padding: 3px 0; margin: 5px 0; font-size: 11px;">
                                <span>TOTAL:</span>
                                <span>KES {{ booking.total_amount|floatformat:0 }}</span>
                            </div>
                        </div>

                        <!-- Payment Method -->
                        <div style="display: flex; justify-content: space-between; margin: 3px 0; font-size: 10px;">
                            <strong>Payment Method:</strong>
                            <span>{{ booking.get_booking_method_display }}</span>
                        </div>

                        <div style="border-top: 1px dashed #000; margin: 8px 0;"></div>

                        <!-- QR Code -->
                        <div style="text-align: center; margin: 10px 0;">
                            <img src="data:image/png;base64,{{ qr_code }}" alt="QR Code" style="width: 60px; height: 60px;">
                            <div style="font-size: 8px; margin-top: 3px;">Scan to verify booking</div>
                        </div>

                        <!-- Admin Stamp -->
                        <div style="border: 1px dashed #000; height: 40px; margin: 10px 0; display: flex; align-items: center; justify-content: center; font-size: 8px; background: #f9f9f9;">
                            ADMIN APPROVAL STAMP
                        </div>

                        <!-- Footer -->
                        <div style="text-align: center; font-size: 8px; margin-top: 10px; border-top: 1px solid #000; padding-top: 5px;">
                            <div>Thank you for choosing WildQuest Kenya!</div>
                            <div style="margin-top: 2px;">Keep this receipt for your records</div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="text-center mt-4">
                    <div class="btn-group" role="group">
                        <a href="{% url 'booking_detail' booking.booking_id %}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Booking
                        </a>
                        <a href="{% url 'booking_receipt_pdf' booking.booking_id %}" class="btn btn-primary">
                            <i class="fas fa-download me-2"></i>Download PDF
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}